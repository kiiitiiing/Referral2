@model IEnumerable<Activity>

@{
    ViewData["Title"] = "Track patient";
}
    <style type="text/css">
        .bs-wizard {margin-top: 20px;}

        /*Form Wizard*/
        .bs-wizard {border-bottom: solid 1px #4caf50; padding: 0 0 10px 0;}
        .bs-wizard > .bs-wizard-step {padding: 0; position: relative;}
        .bs-wizard > .bs-wizard-step + .bs-wizard-step {}
        .bs-wizard > .bs-wizard-step .bs-wizard-stepnum {color: #595959; font-size: 16px; margin-bottom: 5px;}
        .bs-wizard > .bs-wizard-step .bs-wizard-info {color: #999; font-size: 14px;}
        .bs-wizard > .bs-wizard-step > .bs-wizard-dot {position: absolute; width: 30px; height: 30px; display: block; background: #4caf50; top: 45px; left: 50%; margin-top: -15px; margin-left: -15px; border-radius: 50%;}
        .bs-wizard > .bs-wizard-step > .bs-wizard-dot:after {content: ' '; width: 14px; height: 14px; background: #4caf50; border-radius: 50px; position: absolute; top: 8px; left: 8px; }
        .bs-wizard > .bs-wizard-step > .progress {position: relative; border-radius: 0px; height: 8px; box-shadow: none; margin: 20px 0;}
        .bs-wizard > .bs-wizard-step > .progress > .progress-bar {width:0px; box-shadow: none; background: #4caf50;}
        .bs-wizard > .bs-wizard-step.complete > .progress > .progress-bar {width:100%;}
        .bs-wizard > .bs-wizard-step.active > .progress > .progress-bar {width:50%;}
        .bs-wizard > .bs-wizard-step:first-child.active > .progress > .progress-bar {width:0%;}
        .bs-wizard > .bs-wizard-step:last-child.active > .progress > .progress-bar {width: 100%;}
        .bs-wizard > .bs-wizard-step.disabled > .bs-wizard-dot {background-color: #f5f5f5;}
        .bs-wizard > .bs-wizard-step.disabled > .bs-wizard-dot:after {opacity: 0;}
        .bs-wizard > .bs-wizard-step:first-child  > .progress {left: 50%; width: 50%;}
        .bs-wizard > .bs-wizard-step:last-child  > .progress {width: 50%;}
        .bs-wizard > .bs-wizard-step.disabled a.bs-wizard-dot{ pointer-events: none; }
        .bs-wizard-stepnum { color: #4caf50 !important;}
        /*END Form Wizard*/
    </style>
<div class="content">
    <div class="container">
        <div class="row">
            <!-- CARD DANGER -->
            <div class="col-md-3">
                <!-- SELECT DATE -->
                <div class="card card-danger card-green">
                    <!-- CARD DANGER HEADER -->
                    <div class="card-header">
                        <h3 class="card-title">Track Patient</h3>
                    </div>
                    <!-- CARD DANGER BODY -->
                    <form method="post" action="">
                        <input type="hidden" name="_token" value="" autocomplete="off" />
                        <div class="card-body">
                            <!-- SEARCH -->
                            <div class="form-group">
                                <input type="text" placeholder="Code" class="form-control" name="Code" value="@ViewBag.CurrentCode" required autocomplete="off" />
                            </div>
                            <!-- BUTTONS -->
                            <div class="form-group">
                                <!-- FILTER -->
                                <button type="submit" value="Filter" class="btn btn-block btn-default">
                                    <i class="fa fa-search"></i>
                                    &nbsp;Filter
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
                <!-- MAIN MENU -->
                <partial name="~/Views/Shared/PartialViews/_MainMenuPartial.cshtml" />
            </div>
            <div class="col-md-9">
                @if (Model.Count() != 0)
                {
                    var patientName = ViewBag.Patient;
                    var sex = ViewBag.Sex;
                    var age = ViewBag.Age;
                    var address = ViewBag.Patient;
                    var referredBy = ViewBag.ReferredBy;
                    var code = ViewBag.Code;
                    <!-- PATIENT LIST -->
                    <div class="card card-outline">
                        <!-- DAILY USERS HEADER -->
                        <div class="card-header with-border">
                            <h3 class="text-danger">
                                <i class="fa fa-wheelchair"></i>
                                &nbsp;@patientName
                            </h3>
                            <span class="text-sm text-muted">[@sex, @age]from @address</span><br />
                            <span class="text-success">Referred by:</span>
                            <a>@referredBy</a><br />
                            <span class="text-success">Patient Code:</span>
                            <span class="text-warning">@code</span>
                        </div>
                        <!-- DAILY USERS BODY -->
                        <div class="card-body">
                            <!-- BS-WIZARD START -->
                            <div class="row bs-wizard" style="border-bottom:0;">

                                <div class="col-xs-2 bs-wizard-step  complete ">
                                    <!-- complete -->
                                    <div class="text-center bs-wizard-stepnum">
                                        Referred
                                    </div>
                                    <div class="progress"><div class="progress-bar"></div></div>
                                    <a href="javascript:void(0)" class="bs-wizard-dot" title="Referred"></a>
                                </div>

                                <div class="col-xs-2 bs-wizard-step  complete ">
                                    <!-- complete -->
                                    <div class="text-center bs-wizard-stepnum">Seen</div>
                                    <div class="progress"><div class="progress-bar"></div></div>
                                    <a href="javascript:void(0)" class="bs-wizard-dot"></a>
                                </div>

                                <div class="col-xs-2 bs-wizard-step  complete ">
                                    <!-- complete -->
                                    <div class="text-center bs-wizard-stepnum">Accepted</div>
                                    <div class="progress"><div class="progress-bar"></div></div>
                                    <a href="javascript:void(0)" class="bs-wizard-dot"></a>
                                </div>

                                <div class="col-xs-2 bs-wizard-step  complete ">
                                    <!-- complete -->
                                    <div class="text-center bs-wizard-stepnum">
                                        Arrived
                                    </div>
                                    <div class="progress"><div class="progress-bar"></div></div>
                                    <a href="javascript:void(0)" class="bs-wizard-dot"></a>
                                </div>
                                <div class="col-xs-2 bs-wizard-step  complete ">
                                    <!-- complete -->
                                    <div class="text-center bs-wizard-stepnum">Admitted</div>
                                    <div class="progress"><div class="progress-bar"></div></div>
                                    <a href="javascript:void(0)" class="bs-wizard-dot"></a>
                                </div>
                                <div class="col-xs-2 bs-wizard-step  active ">
                                    <!-- complete -->
                                    <div class="text-center bs-wizard-stepnum">Discharged</div>
                                    <div class="progress"><div class="progress-bar"></div></div>
                                    <a href="javascript:void(0)" class="bs-wizard-dot"></a>
                                </div>
                            </div>
                            <!-- TABLE START-->
                            <table>
                                <tbody>
                                    @foreach (var item in Model)
                                    {
                                        var dateReferred = item.DateReferred;
                                        var patient = item.Patient.FirstName + " " + item.Patient.MiddleName + " " + item.Patient.LastName;
                                        var referredFrom = item.ReferredFromNavigation.Name;
                                        //var referredTo = item.ReferredToNavigation.Name;
                                        var actionMd = "Dr. " + item.ActionMdNavigation.Firstname + " " + item.ActionMdNavigation.Middlename + " " + item.ActionMdNavigation.Lastname;
                                        var actionMdFacility = item.ActionMdNavigation.Facility.Name;
                                        //var referringMd = "Dr. " + item.ReferringMdNavigation.Firstname + " " + item.ReferringMdNavigation.Middlename + " " + item.ReferringMdNavigation.Lastname;
                                        //var referringMdFacililty = item.ReferredFromNavigation.Name;
                                        var remarks = item.Remarks;

                                        if (item.Status.Equals("referred"))
                                        {
                                            <tr>
                                                <td>
                                                    <span class="text-muted">@dateReferred</span>
                                                </td>
                                                <td>
                                                    <span class="text-success">@patientName</span>
                                                    was referred by
                                                    <span class="text-info">@Html.DisplayFor(modelItem => item.ReferringMdNavigation.Firstname) @Html.DisplayFor(modelItem => item.ReferringMdNavigation.Middlename) @Html.DisplayFor(modelItem => item.ReferringMdNavigation.Lastname)</span>
                                                    of
                                                    <span class="text-primary">@referredFrom</span>
                                                    to
                                                    <span class="text-primary">@Html.DisplayFor(modelItem => item.ReferredToNavigation.Name)</span>
                                                </td>
                                            </tr>
                                        }
                                        else if (item.Status.Equals("accepted"))
                                        {
                                            <tr>
                                                <td>
                                                    <span class="text-muted">@dateReferred</span>
                                                </td>
                                                <td>
                                                    <span class="text-success">@patientName</span>
                                                    was accepted by
                                                    <span class="text-info">@actionMd</span>
                                                    of
                                                    <span class="text-primary">@actionMdFacility</span>
                                                    <br />
                                                    <span class="text-warning">Remarks: @remarks</span>
                                                </td>
                                            </tr>
                                        }
                                        else if (item.Status.Equals("arrived"))
                                        {
                                            <tr>
                                                <td>
                                                    <span class="text-muted">@dateReferred</span>
                                                </td>
                                                <td>
                                                    <span class="text-success">@patientName</span>
                                                    has arrived at
                                                    <span class="text-info">@actionMdFacility</span>
                                                    <br />
                                                    <span class="text-warning">Remarks: @remarks</span>
                                                </td>
                                            </tr>
                                        }
                                        else if(item.Status.Equals("admitted"))
                                        {
                                            <tr>
                                                <td>
                                                    <span class="text-muted">@dateReferred</span>
                                                </td>
                                                <td>
                                                    <span class="text-success">@patientName</span>
                                                    was admitted at
                                                    <span class="text-info">@actionMdFacility</span>
                                                    <br />
                                                    <span class="text-warning">Remarks: @remarks</span>
                                                </td>
                                            </tr>
                                        }
                                        else if(item.Status.Equals("discharged"))
                                        {
                                            <tr>
                                                <td>
                                                    <span class="text-muted">@dateReferred</span>
                                                </td>
                                                <td>
                                                    <span class="text-success">@patientName</span>
                                                    was discharged from
                                                    <span class="text-info">@actionMdFacility</span>
                                                    <br />
                                                    <span class="text-warning">Remarks: @remarks</span>
                                                </td>
                                            </tr>
                                        }
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                }
                else
                {
                    <div class="alert alert-warning">
                        <span class="text-lg">
                            <i class="fa fa-warning"></i>
                            &nbsp;Referral code couldn't be found!
                        </span>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<div class="modal fade" role="dialog" id="refer_modal">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4>Refer Patient</h4>
            </div>
            <div id="refer_content" class="modal-body">
                <hr />
            </div>
            <div class="clearfix"></div>
        </div>
    </div>
</div>

<script>
    $('body').on('click', '.refer_modal', function () {
        var referId = this.value;
        var url = "/AddPatients/Refer/" + referId;
        $("#refer_content").html("Loading..............");
        $.get(url, function (result) {
            $("#refer_content").html(result);
        })
    });
</script>
